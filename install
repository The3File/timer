PREFIX="${PREFIX:-/usr/local}"
EXCLUDE="LICENSE md install" 

bin_dir="${PREFIX}/bin"
man_dir="${PREFIX}/share/man/man1"

fail(){ [[ $1 ]] && printf '%s\n' "failed to $1"; exit 1;}
success(){ printf '%s\n' "$1 $2";}

install(){
	for bin in ${bins[@]};{
		copy "$bin" "$bin_dir"
		success "installed" "$bin_dir/$bin"
	}
	for man in ${mans[@]};{ copy "$man" "$man_dir";}
	success "installed" "$man_dir/${man##*/}"
}

uninstall(){
	for bin in ${bins[@]};{
		remove "$bin" "$bin_dir"
		success "uninstalled" "$man_dir/${man##*/}"
	}
	for man in ${mans[@]};{ remove "$man" "$man_dir";}
	success "uninstalled" "$man_dir/${man##*/}"
}

copy(){
	[[ "$1" -nt "${2}/${1}" ]] || return
	cp -rf $1 $2 || fail
}

remove(){
	[[ "$1" && "$2" ]] || return 1
	rm "${2}/${1##*/}"|| fail
}

for bin in *;{ [[ -d "$bin" || "$bin" =~ ${EXCLUDE//\ /\|} ]] || bins+=($bin);}
for man in */*;{ [[ "$man" =~ .*\.[0-9] ]] && mans+=($man);}

case $1 in
	u*) uninstall ;;
	'') install ;;
esac
