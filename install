PREFIX="${PREFIX:-/usr/local}"
bin_dir="${PREFIX}/bin"
man_dir="${PREFIX}/share/man/man1"

bins=("timer" "pomodoro" "man/timer.1")

install(){
	dir="$bin_dir"
	[[ ${1%%/*} = man ]] && dir="$man_dir"
	copy  "$1" "$dir"
}

uninstall(){
	dir="$bin_dir"
	[[ ${1%%/*} = man ]] && dir="$man_dir"
	remove "$dir/$1"
}

copy(){
	[[ "$1" -nt "${2}/${1}" ]] || return
	cp -rf $1 $2 || return
	printf '%s\n' "installed $1 to $2"
}

remove(){
	[[ "$1" ]] || return
	rm "$1" || return
	printf '%s\n' "uninstalled $1"
}

check_dirs(){
	for dir in "$@"; do
		[[ -d $dir ]] && return 0
		printf '%s\n' "$dir: no such dir"
		exit 1
	done
}

check_dirs "$bin_dir" "$man_dir"

case $1 in
	u*) for bin in ${bins[@]};{ uninstall "$bin"; } ;;
	'') for bin in ${bins[@]};{ install "$bin"; } ;;
esac
